% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is a simple template for a LaTeX document using the "article" class.
% See "book", "report", "letter" for other types of document.

\documentclass[11pt]{article} % use larger type; default would be 10pt

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)
\usepackage{fontspec}  %Only for XeLaTeX or LuaLaTeX
%%% Examples of Article customizations
% These packages are optional, depending whether you want the features they provide.
% See the LaTeX Companion or other references for full information.

%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper} % or letterpaper (US) or a5paper or....
% \geometry{margin=2in} % for example, change the margins to 2 inches all round
% \geometry{landscape} % set up the page for landscape
%   read geometry.pdf for detailed page layout information

\usepackage{graphicx} % support the \includegraphics command and options

% \usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent

%%% PACKAGES
\usepackage{booktabs} % for much better looking tables
\usepackage{array} % for better arrays (eg matrices) in maths
\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
% These packages are all incorporated in the memoir class to one degree or another...
\usepackage{tcolorbox}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}

%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

%%% SECTION TITLE APPEARANCE
\usepackage{sectsty}
\allsectionsfont{\sffamily\mdseries\upshape} % (See the fntguide.pdf for font help)
% (This matches ConTeXt defaults)

%%% ToC (table of contents) APPEARANCE
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!

%%% END Article customizations

%%% The "real" document content comes below...

\title{Real-time plotter and fitter server manual}
\author{Oleksiy Onishchenko}
%\date{} % Activate to display a given date or no date (if empty),
         % otherwise the current date is printed 

\begin{document}
\maketitle

\section{Notation}

\begin{itemize}
	\item File and folder names are given in the following font {\fontspec{QTCascadetype} myfavoritefile.py} 
	\item Two
	\item Three
\end{itemize}

\section{Basic principles, design philosophy, and governing ideas}

\section{Client-server structure}

The principal idea of the project is to make this plotter-fitter work as a remote server. It should be possible to send all data and commands remotely and get answers back. Of course there is a GUI layer on top, in order to visualize the plots and fits, read the results off the screen, and also do some manual adjustment of plotting, but a big focus of programming this tool is to make it function as a remote server.

The main server class {\fontspec{sourcecodepro} TCPIPserver} is located in file {\fontspec{QTCascadetype} socketserver.py}. It is defined to work in two modes: either one-way, where it only receives messages from the client and does not send any info back, or in two-way more, where a round of communication consists of message reception and transmission. {\fontspec{QTWestEnd} test test test}



\section{TCP/IP commands}

All commands must be sent as character strings in utf-8 encoding for now (if that's impossible, one could implement ascii encoding/decoding procedure). Most of the times, commands must be separated with a semicolon [;]. Different options within a single command must be separated with a comma [,]. 

Before any commands can be sent, one needs to write down the IP address and the port of the computer where the server is running. If the server is running on the same computer as the client, the IP address will be [127.0.0.1]. The port can basically be chosen at will, as long as its value is a large number, beyond the range of the standard reserved ports. One also has to establish the buffer size for communication, but that does not matter mostly. A common value is [2048], which corresponds to 2048 bytes.

Most of the commands do not require or expect a response from the server. They are in a sense a one-way communication. The box below shows the general setup of sending commands to the plotter, assuming that they are sent from Python. The goal is to make this a general-purpose plotter and fitter server, so since it works with TCP/IP, it doesn't really matter which programming language the commands are sent from, Python is only an example 
\begin{tcolorbox}[title=General approach to sending commands]


{\fontfamily{pcr}\selectfont import socket}

{\fontfamily{pcr}\selectfont s = socket.socket(socket.AF\_INET, socket.SOCK\_STREAM)}

{\fontfamily{pcr}\selectfont s.connect((HOST, PORT))}

{\fontfamily{pcr}\selectfont message\_string = ``my favorite message''}

{\fontfamily{pcr}\selectfont message = my\_information.encode("utf-8",errors="ignore")}

{\fontfamily{pcr}\selectfont sendres = s.sendall(message)}

{\fontfamily{pcr}\selectfont s.close()}
\\

The most important idea here is that one must close the socket communication after sending every message. Sockets are recycled. 
 
\end{tcolorbox}

One class of commands sends data to the plotter. The result will be that the points are plotted on the main plotter canvas. The following box provides the list of these commands.

\begin{tcolorbox}[title=Sending data point by point]

Sending data without error bars: 
\\

{\fontfamily{pcr}\selectfont listdata errorbar\_no xx.xxxxx vv.vvvvv vv.vvvvv  $...$}
\\

Here, [x], [v] refer to the digits of the numbers representing the x-axis and the values respectively. The x-axis can be anything, for example time. one has to put at most 6 digits after the comma. Each value [vv.vvvvv] will correspond to a curve on the plot. The number of values, and consequently the number of curves, can be whatever. However, you have to always send the same number of curves, once you started sending that number. For example, if you started sending 2 curves, keep sending always two curves until you clear data, otherwise you will generate an error. 
\\

Sending data with error bars:
\\

{\fontfamily{pcr}\selectfont listdata errorbar\_yes xx.xxxxx vv.vvvvv ee.eeeee vv.vvvvv ee.eeeee  $...$}
\\

Here, [x], [v], [e] refer to the digits of the numbers representing the x-axis, the values, and the corresponding error bars respectively. The x-axis can be anything. Each combination [vv.vvvvv ee.eeeee] will correspond to a curve on the plot. One must always feed values with error bars, in other words one cannot plot one curve with error bars and one curve without, that will generate an error, and one must always send the same number of curves unless one has cleared the plot and starts plotting again. 

\end{tcolorbox}

After one is done with plotting, and possibly fitting, etc., one has to clear the plots and the memory for the next set of data to be sent, plotted, and processed. That can be achieved with the [clear\_data] command:

\begin{tcolorbox}[title=Clearing data plot and fit results]

{\fontfamily{pcr}\selectfont config; clear\_data all}
\\

For now, only [all] is implemented, but the idea is to implement the possibility of clearing one particular curve without touching the other ones.
\end{tcolorbox}

We can also transmit plot parameters, such as axes labels, plot title, legend, via TCP/IP. In addition, we can send the function choice for fitting, starting parameters for the fit, and the request to do the fit. All of these are \textbf{configuration commands}, which can be sent in a string starting with [config].

\begin{tcolorbox}[title=Configuration command string (config)]

At the beginning of the command string we always write:
\\

{\fontfamily{pcr}\selectfont config;}
\\

From then on, the following commands are defined: 
\\

{\fontfamily{pcr}\selectfont set\_axis\_labels myXlabel, myYlabel}

myXlabel and myYlabel and the text that will label the axes
\\

{\fontfamily{pcr}\selectfont set\_plot\_title myPlotTitle}

myPlotTitle will be written above the plot area
\\

{\fontfamily{pcr}\selectfont set\_fit\_function fitfunctionname}

fitfunctionname must exactly match one of the defined fit functions in file mathfunctions/fitmodels.py
\\

{\fontfamily{pcr}\selectfont set\_curve\_number number}

number is the number (string) of one of the curves that has been sent to the plotter. See the box above about sending data point by point, the first point would correspond to number being 0, the second point corresponds to number being 1, etc. 
\\

{\fontfamily{pcr}\selectfont set\_starting\_parameters param1name : value1 , param2name : value2, ...}

\textbf{Not yet implemented fully}
These parameters are what is given in the parameter dictionary of the fit function, which is in mathfunctions/fitmodels.py The names of the parameters must be written exactly as in that parameter dictionary, otherwise it will produce errors. The fitter will take these parameters as initial values.  
\\

{\fontfamily{pcr}\selectfont do\_fit}

\textbf{Not yet implemented fully}
This will perform the fit and display the graph on top of the data points
\\

The commands can be sent in any order, separated by semicolons. So a valid command string would be like 

{\fontfamily{pcr}\selectfont config; set\_axis\_labels myX1, myY1; set\_plot\_title myCoolData; ... }

where ... refers to additional commands. It is also ok to send command strings separately, they are processed as they come in, so for example one can send like 

{\fontfamily{pcr}\selectfont config; set\_axis\_labels myX1, myY1; set\_plot\_title myCoolData; ... }

{\fontfamily{pcr}\selectfont config; set\_fit\_function sinewave; set\_curve\_number 0; do\_fit}

Remember that each of the commands has to be sent as a separate session of TCP/IP communication. The thing though is that it's better to send the whole command statement as a single string, because otherwise one can run into problems if one for example calls [do\_fit] before setting the curve number, and so on. 

\end{tcolorbox}



\subsection{A subsection}

More text.

\section{Background software and hardware requirements}



\end{document}
